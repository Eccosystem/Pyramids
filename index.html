<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ancient Echoes - An Interactive Journey</title>
    <meta name="description" content="Explore the ancient mysteries of the Bosnian Pyramids through an interactive art project. Discover stories, meditate on the energies, and share your own experiences.">
    <meta name="keywords" content="Bosnian Pyramids, interactive art, ancient wisdom, mystical, prophecy, meditation, spiritual, energy, runes">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>✨</text></svg>">
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;700&family=Spectral:wght@300;400;700&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --night-bg-start: #020617; --night-bg-end: #000000;
            --primary-night: #FFD700; --secondary-night: #e0e0e0;
        }
        @font-face {
            font-family: 'RunicFont'; src: url('fonts/NotoSansRunic-Regular.woff2') format('woff2');
            font-weight: normal; font-style: normal; font-display: swap;
        }
        @media (prefers-reduced-motion: reduce) {
            body, .main-content-area, .pyramid, .celestial-body, .beam, #interactive-background, .hotspot {
                animation: none !important; transition: none !important;
            }
        }
        html { scroll-behavior: smooth; }
        body {
            font-family: 'Inter', sans-serif; display: flex; flex-direction: column;
            justify-content: flex-start; align-items: center; margin: 0; overflow-x: hidden; position: relative;
            background-image: url('https://images.pexels.com/photos/1252890/pexels-photo-1252890.jpeg?auto=compress&cs=tinysrgb&w=1260&h=750&dpr=2');
            background-color: #000000; background-size: cover; background-position: center center;
            background-repeat: no-repeat; background-attachment: fixed;
        }
        #interactive-background {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            z-index: 1; transition: opacity 2s ease-in-out; pointer-events: none;
        }
        .hidden { display: none !important; }
        .main-content-area {
            z-index: 10; width: 95%; max-width: 900px; display: flex;
            flex-direction: column; align-items: center; padding: 1rem; box-sizing: border-box;
            opacity: 0; transition: opacity 1.5s ease-in-out; min-height: 100vh;
        }
        .main-content-area.active { opacity: 1; }
        main { flex-grow: 1; width: 100%; display: flex; flex-direction: column; align-items: center;}
        .app-header {
            width: 100%; display: flex; justify-content: space-between;
            align-items: center; padding: 1rem 0; z-index: 20;
        }
        .title-container { text-align: left; flex-grow: 1; }
        .app-header h1 {
            font-family: 'RunicFont', 'Spectral', serif; font-size: clamp(1.5rem, 4vw, 2.2rem);
            margin: 0; text-shadow: 0 0 15px rgba(255, 215, 0, 0.8);
            animation: title-glow 4s infinite alternate; color: var(--primary-night); letter-spacing: 0.1em;
        }
        .runic-subtitle {
            font-family: 'Spectral', serif; font-size: clamp(0.8rem, 2vw, 1rem);
            color: #b8860b; text-shadow: 0 0 5px rgba(255, 215, 0, 0.5);
            margin: 0.25rem 0 0 0; letter-spacing: normal;
        }
        @keyframes title-glow {
            from { text-shadow: 0 0 15px rgba(255, 215, 0, 0.6); color: var(--primary-night); }
            to { text-shadow: 0 0 20px rgba(255, 180, 0, 0.9); color: #fff8e1; }
        }
        .menu-container {
            position: fixed; top: 1rem; right: 1rem; z-index: 1001;
        }
        .celestial-body {
            width: 60px; height: 60px; border-radius: 50%;
            background-size: cover; background-position: center; cursor: pointer;
            user-select: none; pointer-events: auto; display: flex; justify-content: center;
            align-items: center; background-image: url('menu-moon.png');
            box-shadow: 0 0 15px 3px rgba(255, 255, 255, 0.5), 0 0 35px 10px rgba(255, 215, 0, 0.2);
            animation: subtle-pulse 5s infinite ease-in-out; transition: all 0.3s ease-in-out;
        }
        @keyframes subtle-pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.03); }
        }
        .celestial-body:hover { transform: scale(1.05); }
        .menu-hint-label {
            color: white; font-family: 'Spectral', serif; font-size: 1rem; font-weight: bold;
            letter-spacing: 0.1em; text-shadow: 0 0 8px black; pointer-events: none;
        }
        .overlay-menu {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background-color: rgba(10, 0, 20, 0.95); display: flex; flex-direction: column;
            justify-content: center; align-items: center; z-index: 1000;
            opacity: 0; visibility: hidden; transition: opacity 0.5s ease, visibility 0.5s ease;
        }
        .overlay-menu.active { opacity: 1; visibility: visible; }
        .overlay-menu-close {
            position: absolute; top: 1rem; right: 1rem; background: none; border: none;
            color: var(--primary-night); font-size: 2rem; cursor: pointer; transition: transform 0.3s ease;
        }
        .overlay-menu-close:hover { transform: rotate(90deg); }
        .overlay-menu nav { width: 100%; max-width: 700px; padding: 0 1rem; }
        .overlay-menu nav ul {
            list-style: none; padding: 0; margin: 0; display: grid;
            grid-template-columns: 1fr 1fr; gap: 1.5rem 2.5rem;
        }
        .overlay-menu nav ul li { position: relative; }
        .menu-divider::after {
            content: ''; position: absolute; bottom: -0.75rem; left: 10%;
            width: 80%; height: 1px; background-color: rgba(255, 215, 0, 0.2);
        }
        .overlay-menu nav ul li a {
            color: var(--secondary-night); text-decoration: none;
            display: flex; align-items: center; gap: 1rem;
            transition: all 0.3s ease; font-family: 'Spectral', serif; text-shadow: none; padding: 0.5rem 0;
        }
        .overlay-menu nav ul li a:hover {
            color: var(--primary-night); transform: translateX(10px);
            text-shadow: 0 0 10px rgba(255, 215, 0, 0.8);
        }
        .runic-icon {
            font-family: 'RunicFont', 'Spectral', serif; font-size: 2rem;
            color: var(--primary-night); transition: all 0.3s ease; flex-shrink: 0;
        }
        .menu-text-group { display: flex; flex-direction: column; text-align: left; }
        .menu-title { font-size: clamp(1rem, 2.5vw, 1.3rem); }
        .menu-subtitle { font-size: 0.75rem; color: #a0aec0; transition: color 0.3s ease; opacity: 0.8; }
        .overlay-menu nav ul li a:hover .menu-subtitle { color: var(--primary-night); }
        .overlay-menu nav ul li a:hover .runic-icon {
            transform: scale(1.2); filter: drop-shadow(0 0 8px var(--primary-night));
        }
        .page { display: none; width: 100%; }
        .page.active { display: flex; flex-direction: column; align-items: center; animation: fadeIn 1s ease; width: 100%;}
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .page-content-container {
            width: 100%; max-width: 900px; background-color: rgba(0,0,0,0.6);
            border: 1px solid #4a5568; border-radius: 1rem; padding: 2rem; margin-top: 1.5rem;
        }
        h2.page-title { text-align: center; font-size: clamp(2rem, 5vw, 2.5rem); font-family: 'Spectral', serif; color: var(--primary-night); text-shadow: 0 0 10px var(--primary-night); margin-bottom: 1.5rem; }
        p.page-intro { text-align: center; color: var(--secondary-night); font-style: italic; max-width: 650px; margin: 0 auto 2rem; line-height: 1.6; }
        .content-box { background-color: rgba(0,0,0,0.5); border: 1px solid #4A5568; border-radius: 0.75rem; padding: 1.2rem; margin-top: 1.5rem; }
        .pyramids-visual-group { position: relative; width: 100%; display: flex; justify-content: center; align-items: flex-end; margin-top: 2rem; min-height: 350px; }
        .pyramid-container { display: flex; justify-content: center; align-items: flex-end; gap: 1rem; }
        .pyramid { position: relative; cursor: pointer; transition: transform 0.3s ease; display: flex; flex-direction: column; align-items: center; }
        .pyramid:hover { transform: translateY(-5px); }
        .pyramid-shape { background: linear-gradient(45deg, #4a4a4a, #1a1a1a); width: 100%; aspect-ratio: 2 / 1; clip-path: polygon(50% 0%, 0% 100%, 100% 100%); position: relative; }
        .pyramid.center { width: 220px; }
        .pyramid.center .pyramid-shape { background: linear-gradient(45deg, #DAA520, #B8860B); }
        .pyramid.side { width: 80px; transform: translateY(30px); }
        .pyramid-name { margin-top: 0.75rem; font-family: 'Spectral', serif; color: var(--primary-night); text-shadow: 0 0 8px rgba(255, 215, 0, 0.7); }
        .whisper-box { min-height: 80px; display: flex; flex-direction: column; justify-content: center; align-items: center; text-align: center; font-style: italic; font-size: clamp(0.9rem, 1.5vw, 1.1rem); max-width: 90%; width: 100%; position: relative; }
        .whisper-box.loading::after { content: '...'; animation: blinking-dots 1.5s infinite; position: absolute; color: var(--primary-night); font-size: 2rem;}
        @keyframes blinking-dots { 0%{opacity: 0;} 50%{opacity: 1;} 100%{opacity: 0;} }
        .runic-text {
            font-family: 'Spectral', serif; font-size: clamp(1.5rem, 3vw, 2.2rem);
            color: var(--primary-night); text-shadow: 0 0 10px rgba(255, 215, 0, 0.6);
            min-height: 1.5em;
            transition: opacity 0.5s ease-in-out;
        }
        .english-translation { color: var(--secondary-night); opacity: 0; max-height: 0; overflow: hidden; transition: opacity 0.5s ease, max-height 0.5s ease; }
        .english-translation.visible { opacity: 1; max-height: 500px; margin-top: 0.5rem; }
        .bio-accordion-item { border-bottom: 1px solid #4a5568; }
        .bio-accordion-header {
            background: none; border: none; width: 100%; text-align: left; padding: 1rem;
            color: var(--primary-night); font-family: 'Spectral', serif; font-size: 1.25rem;
            cursor: pointer; display: flex; justify-content: space-between; align-items: center;
        }
        .bio-accordion-header::after { content: '+'; font-size: 1.5rem; transition: transform 0.3s ease; }
        .bio-accordion-header.active::after { transform: rotate(45deg); }
        .bio-accordion-content {
            max-height: 0; overflow: hidden; transition: max-height 0.5s ease-out;
            padding: 0 1rem; line-height: 1.7; color: #a0aec0;
        }
        .bio-accordion-content.active { max-height: 1500px; padding: 0 1rem 1rem; }
        .bio-accordion-content p { margin-bottom: 1rem; }
        .bio-accordion-content ul { list-style: disc; list-style-position: inside; margin-left: 1rem; margin-bottom: 1rem; }
        .bio-accordion-content img { width: 100%; max-width: 300px; height: auto; border-radius: 0.5rem; margin: 1rem auto; display: block; }
        .donate-button { background: linear-gradient(to bottom right, #DAA520, #B8860B); color: #1a1a1a; padding: 0.8rem 2rem; border-radius: 0.5rem; font-weight: bold; font-size: 1.1rem; text-decoration: none; display: inline-block; transition: all 0.3s ease; }
        .donate-button:hover { transform: translateY(-2px); box-shadow: 5px 5px 15px rgba(255, 215, 0, 0.3); }
        .whisper-button { background: linear-gradient(to bottom right, #5a6578, #3d4758); color: #ffcc00; padding: 0.6rem 1.2rem; border-radius: 0.5rem; font-weight: bold; cursor: pointer; transition: all 0.3s ease; border: none; width: 100%; }
        .whisper-button:hover { background: linear-gradient(to bottom right, #6a7588, #4d5768); transform: translateY(-2px); }
        .app-footer { width: 100%; max-width: 900px; padding: 2rem 1rem 1rem; text-align: center; border-top: 1px solid rgba(255, 215, 0, 0.2); margin-top: auto; }
        .social-share-buttons { display: flex; justify-content: center; gap: 1rem; }
        .social-share-button { color: #a0aec0; transition: color 0.3s ease, transform 0.3s ease; }
        .social-share-button:hover { color: var(--primary-night); transform: scale(1.1); }
        .social-share-button svg { width: 24px; height: 24px; }
        .keepers-grid { display: flex; flex-wrap: wrap; justify-content: center; gap: 0.5rem; margin: 1.5rem auto; }
        .keeper-rune { font-family: 'Spectral', serif; font-size: 2rem; color: var(--primary-night); opacity: 0.6; text-shadow: 0 0 10px rgba(255, 215, 0, 0.5); }
        #map-container { position: relative; width: 100%; max-width: 600px; margin: 2rem auto; }
        #map-container img { width: 100%; height: auto; border-radius: 0.5rem; }
        .hotspot { position: absolute; width: 25px; height: 25px; background-color: rgba(255, 215, 0, 0.7); border: 2px solid white; border-radius: 50%; cursor: pointer; transition: all 0.3s ease; box-shadow: 0 0 15px rgba(255, 215, 0, 0.8); animation: pulseHotspot 2s infinite; }
        .hotspot:hover { transform: scale(1.2); background-color: rgba(255, 215, 0, 1); }
        @keyframes pulseHotspot { 0% { box-shadow: 0 0 15px rgba(255, 215, 0, 0.8); } 50% { box-shadow: 0 0 25px rgba(255, 215, 0, 1); } 100% { box-shadow: 0 0 15px rgba(255, 215, 0, 0.8); } }
        #lore-modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.8); z-index: 1100; display: flex; justify-content: center; align-items: center; opacity: 0; pointer-events: none; transition: opacity 0.3s ease; }
        #lore-modal.visible { opacity: 1; pointer-events: auto; }
        .lore-content { background-color: #10141c; border: 1px solid var(--primary-night); padding: 2rem; border-radius: 1rem; width: 90%; max-width: 500px; position: relative; }
        .lore-close-button { position: absolute; top: 1rem; right: 1rem; background: none; border: none; color: var(--primary-night); font-size: 1.5rem; cursor: pointer; }
        .story-card { background-color: rgba(0,0,0,0.3); border: 1px solid #4a5568; border-radius: 0.5rem; padding: 1rem; margin-bottom: 1rem; }
        .story-card .story-rune { font-family: 'Spectral', serif; font-size: 2rem; color: var(--primary-night); }
        .story-card .story-text { color: #e0e0e0; margin-top: 0.5rem; font-style: italic; }
        .story-card .story-meta { color: #a0aec0; font-size: 0.8rem; margin-top: 0.5rem; display: flex; justify-content: space-between; align-items: center; }
        #enterButton {
            background-color: transparent; border: 1px solid var(--primary-night);
            color: var(--primary-night); padding: 0.75rem 1.5rem; border-radius: 0.5rem;
            font-family: 'Spectral', serif; font-size: clamp(1rem, 2vw, 1.2rem); margin-top: 2rem;
            cursor: pointer; transition: all 0.3s ease; animation: pulse-glow 3s infinite alternate;
        }
        #enterButton:hover {
            background-color: rgba(255, 215, 0, 0.1); box-shadow: 0 0 15px rgba(255, 215, 0, 0.5);
            transform: scale(1.05);
        }
        @keyframes pulse-glow {
            from { border-color: rgba(255, 215, 0, 0.7); text-shadow: 0 0 5px rgba(255, 215, 0, 0.5); }
            to { border-color: rgba(255, 215, 0, 1); text-shadow: 0 0 10px rgba(255, 215, 0, 0.8); }
        }
        
        .shooting-beam {
            position: fixed;
            transform-origin: top center;
            width: 2ch; 
            z-index: 999;
            pointer-events: none;
            overflow: hidden;
            color: var(--primary-night);
            font-family: 'RunicFont', 'Spectral', serif;
            font-size: 1.2rem;
            line-height: 1;
            text-shadow: 0 0 8px var(--primary-night);
            word-break: break-all;
            opacity: 0;
            transition: opacity 0.5s ease-out 1s; /* Fade out after 1 second */
        }
        .shooting-beam-inner {
            height: 200%;
            animation: flow-down 1.5s linear infinite;
        }
        @keyframes flow-down {
            from { transform: translateY(-50%); }
            to { transform: translateY(0%); }
        }

        @media (max-width: 768px) { .celestial-body { width: 50px; height: 50px; } }
        @media (max-width: 640px) { .overlay-menu nav ul { grid-template-columns: 1fr; } }
    </style>
</head>
<body>
    
    <canvas id="interactive-background"></canvas>
    
    <div id="initialEntryOverlay" class="flex justify-center items-center fixed inset-0 bg-black z-[2000] text-center cursor-pointer" aria-label="Click to awaken the veil and start the experience.">
        <div class="flex flex-col items-center p-4">
            <p class="font-[RunicFont,Spectral,serif] text-[clamp(2rem,6vw,3.5rem)] text-primary-night [text-shadow:0_0_10px_rgba(255,215,0,0.7)] tracking-[0.1em] order-1">ᛅᚾᛋᛁᛅᚾᛏ ᛂᚴᚬᛋ</p>
            <h2 class="font-[Spectral,serif] text-[clamp(1.5rem,4vw,2.5rem)] order-2 mt-6">Ancient Echoes of the Bosnian Pyramids</h2>
            <button id="enterButton" class="order-3">Click to Awaken the Veil</button>
        </div>
    </div>

    <div class="menu-container">
        <button class="celestial-body" id="menuButton" aria-label="Open portal navigation">
            <span id="menuHint" class="menu-hint-label">MENU</span>
        </button>
    </div>

    <div class="overlay-menu" id="overlayMenu">
        <button class="overlay-menu-close" id="closeMenuButton" aria-label="Close portal menu"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><line x1="15" y1="9" x2="9" y2="15"></line><line x1="9" y1="9" x2="15" y2="15"></line></svg></button>
        <nav aria-label="Main navigation">
            <ul>
                <li><a href="#home" class="page-link" data-page="home"><span class="runic-icon">ᚷ</span><div class="menu-text-group"><span class="menu-title">Home Portal</span><span class="menu-subtitle">Begin Your Journey</span></div></a></li>
                <li class="menu-divider"><a href="#visoko" class="page-link" data-page="visoko"><span class="runic-icon">ᚱ</span><div class="menu-text-group"><span class="menu-title">Explore the Valley</span><span class="menu-subtitle">Learn the Land</span></div></a></li>
                <li><a href="#runeReading" class="page-link" data-page="runeReading"><span class="runic-icon">ᛈ</span><div class="menu-text-group"><span class="menu-title">The Seer's Whisper</span><span class="menu-subtitle">Gain Insight</span></div></a></li>
                <li class="menu-divider"><a href="#meditation" class="page-link" data-page="meditation"><span class="runic-icon">ᛃ</span><div class="menu-text-group"><span class="menu-title">The Inner Well</span><span class="menu-subtitle">Look Within</span></div></a></li>
                <li><a href="#storyteller" class="page-link" data-page="storyteller"><span class="runic-icon">ᚹ</span><div class="menu-text-group"><span class="menu-title">The Runic Chronicle</span><span class="menu-subtitle">Lend Your Energy</span></div></a></li>
                <li class="menu-divider"><a href="#expedition" class="page-link" data-page="expedition"><span class="runic-icon">ᛇ</span><div class="menu-text-group"><span class="menu-title">The Expedition</span><span class="menu-subtitle">Understand the Mission</span></div></a></li>
                <li><a href="#keeper" class="page-link" data-page="keeper"><span class="runic-icon">ᚠ</span><div class="menu-text-group"><span class="menu-title">Become a Keeper</span><span class="menu-subtitle">Preserve the Mystery</span></div></a></li>
            </ul>
        </nav>
    </div>

    <div class="main-content-area" id="mainContentArea">
        <header class="app-header">
            <div class="title-container"><h1>ᛅᚾᛋᛁᛅᚾᛏ ᛂᚴᚬᛋ</h1><p class="runic-subtitle">Ancient Echoes of the Bosnian Pyramids</p></div>
        </header>
        
        <main>
            <section id="homePage" class="page">
                <h2 class="page-title">The Seeker's Journey Begins</h2>
                <p class="page-intro">You stand at the threshold. This portal is the first step on a path into the living mystery of the Bosnian Pyramids. Listen to the echoes, consult the runes, and decide if you will help preserve this sacred space. Your journey starts now.</p>
                <div class="w-full max-w-2xl bg-yellow-400/10 border border-yellow-400/30 rounded-lg p-4 mb-8 text-center animate-pulse">
                    <h3 class="text-yellow-300 font-bold text-lg font-spectral">The Perseid Alignment is Active!</h3>
                    <p class="text-gray-300 text-sm">Until the last meteor falls this week, the veil is thin. All new Keepers will have their offering rune etched in starlight.</p>
                </div>
                <p class="text-yellow-400 mb-4 text-center">Touch a pyramid to listen to the ancient echoes.</p>
                <div class="pyramids-visual-group" id="pyramidGroup"><div class="pyramid-container"><button class="pyramid side" data-pyramid="dragon" aria-label="Touch the Dragon Pyramid"><div class="pyramid-shape"></div><h3 class="pyramid-name">Dragon</h3></button><button class="pyramid center" data-pyramid="sun" aria-label="Touch the Sun Pyramid"><div class="pyramid-shape"></div><h3 class="pyramid-name">Sun</h3></button><button class="pyramid side" data-pyramid="moon" aria-label="Touch the Moon Pyramid"><div class="pyramid-shape"></div><h3 class="pyramid-name">Moon</h3></button></div></div>
                <div class="whisper-box content-box" id="whisperBox"><div class="runic-text" id="runicOutput">Click a pyramid to begin...</div><div class="english-translation" id="englishOutput"></div><button class="runic-toggle hidden" id="toggleTranslation">Show Translation</button></div>
                <div class="mt-8 flex flex-col sm:flex-row gap-4 w-full max-w-md"><a href="#visoko" data-page="visoko" class="flex-1 whisper-button p-4 text-center page-link">Explore the Valley</a><a href="#keeper" data-page="keeper" class="flex-1 donate-button p-4 text-center page-link">Become a Keeper</a></div>
            </section>

            <section id="expeditionPage" class="page">
                <div class="page-content-container text-gray-300"><h2 class="page-title">The Expedition</h2><p class="page-intro">This portal is both an interactive art project and a living investigation. Here, you can learn about our mission and the real-world research that inspires it.</p><div class="border-t border-gray-600 pt-6 mt-6"><h3 class="text-2xl font-bold text-yellow-400 mb-2 font-spectral">Our Mission</h3><p class="mb-6">Our goal is to create a space for contemplation and imagination. We use technology and storytelling not to provide definitive answers, but to evoke the profound sense of wonder that sites like the Bosnian Pyramids inspire. We believe that by engaging with the mystery, we connect with a deeper part of ourselves.</p><h3 class="text-2xl font-bold text-yellow-400 mb-2 font-spectral">The Research</h3><p class="mb-6">The theories surrounding the Bosnian Pyramids, primarily researched by Dr. Semir Osmanagić, suggest that the hills in the Visoko valley are colossal man-made structures. Key claims include the presence of high-quality, ancient concrete blocks, precise orientation to cosmic north, and measurable energy phenomena. This research challenges conventional historical timelines and suggests the existence of a highly advanced ancient civilization.</p><h3 class="text-2xl font-bold text-yellow-400 mb-2 font-spectral">The Controversy</h3><p class="mb-6">It is important to acknowledge that these claims are not accepted by mainstream archaeology and geology. Many established institutions consider the hills to be natural formations called flatirons. This project does not claim to resolve this debate, but rather to explore the power of the *idea* and the energy of the location that has drawn thousands of volunteers and researchers from around the world.</p><h3 class="text-2xl font-bold text-yellow-400 mb-2 font-spectral">Dive Deeper</h3><ul class="list-disc list-inside text-yellow-400/80"><li><a href="https://bosnian-pyramid.com/" target="_blank" rel="noopener noreferrer" class="hover:underline">Official Bosnian Pyramid of the Sun Foundation</a></li><li><a href="https://www.youtube.com/c/BosnianPyramidTV/videos" target="_blank" rel="noopener noreferrer" class="hover:underline">Dr. Osmanagić's Video Updates</a></li></ul></div></div>
            </section>

            <section id="visokoPage" class="page">
                <div class="page-content-container text-gray-300"><h2 class="page-title">Explore the Valley</h2><p class="page-intro">Each location in the valley has its own unique energy, its own secret to share. Click a hotspot on the map to discover its lore and attune to its runic frequency.</p><div id="map-container"><img src="map.png" alt="Map of the Visoko Valley"><div class="hotspot" style="top: 35%; left: 45%;" data-point="sun"></div><div class="hotspot" style="top: 55%; left: 20%;" data-point="moon"></div><div class="hotspot" style="top: 58%; left: 70%;" data-point="dragon"></div><div class="hotspot" style="top: 75%; left: 48%;" data-point="tunnels"></div></div></div>
            </section>

            <section id="runeReadingPage" class="page">
                <div class="page-content-container"><h2 class="page-title">The Seer's Whisper</h2><p class="page-intro">Seeker, present your query to the stones. Focus your mind on a question, and the runes will offer a reflection. Not a simple answer, but a deeper truth to contemplate.</p><div class="user-input-section flex flex-col items-center w-full max-w-md mx-auto gap-3"><input type="text" id="runeQuestionInput" class="w-full p-2 rounded bg-gray-800 text-white text-center" placeholder="Ask the runes a question..." aria-label="Rune question input"><button class="whisper-button" id="drawRunesButton">Draw Runes</button></div><div class="text-center"><div id="runeDisplay" class="font-['Spectral',serif] text-5xl tracking-[0.5rem] text-primary-night [text-shadow:0_0_15px_rgba(255,215,0,0.8)] mt-6 min-h-[1.5em]"></div><div id="runeInterpretation" class="text-secondary-night italic mt-4 min-h-[3em] leading-relaxed"></div></div><div class="mt-12 border-t border-gray-600 pt-6"><h3 class="text-2xl font-bold text-yellow-400 mb-4 font-spectral text-center">The Discoverer & The Dogma</h3><div class="bio-accordion"><div class="bio-accordion-item"><button class="bio-accordion-header">Dr. Semir Osmanagić: The Scholar</button><div class="bio-accordion-content"><p>Before the world knew him as "the Bosnian pyramid man," Dr. Osmanagić had already built a formidable academic and professional career. His background is crucial to understanding the methodical approach he brings to his work. He holds a Ph.D. in the Sociology of History, with a specific focus on the Mayan civilization, and has served as a <strong>Professor of Anthropology</strong>.</p><img src="runic11.webp" alt="Ancient Pavement found on the Pyramid of the Sun"></div></div><div class="bio-accordion-item"><button class="bio-accordion-header">The Quest for Truth in Visoko</button><div class="bio-accordion-content"><p>His on-the-ground investigation began in 2005. His team, adopting a <strong>multidisciplinary approach</strong>, brought in geologists, physicists, and archaeologists. Core drilling and excavations revealed what appear to be high-quality, <strong>man-made concrete blocks</strong>, far stronger than modern concrete. Instruments have also allegedly detected an unusual, continuous <strong>electromagnetic energy beam</strong> emanating from the apex of the Pyramid of the Sun.</p><img src="runic7.webp" alt="Aerial view of the Pyramid of the Sun"></div></div><div class="bio-accordion-item"><button class="bio-accordion-header">The Fight Against Mainstream Dogma</button><div class="bio-accordion-content"><p>Dr. Osmanagić's claims were met with immediate and fierce opposition. However, he and his supporters highlight a critical point: the most vocal critics have largely been <strong>"armchair archaeologists"</strong> who have never set foot in Visoko to examine the evidence firsthand. He frames this as a battle against institutional dogma that refuses to entertain evidence challenging established historical timelines.</p><img src="runic2.webp" alt="The Ravne Megalith with runic carvings"></div></div></div></div></div>
            </section>
            
            <section id="meditationPage" class="page">
                 <div class="page-content-container"><h2 class="page-title">The Inner Well</h2><p class="page-intro">Still your mind and connect with the ancient energies. Focus on the pulsing rune and allow its meaning to guide your meditation. This is a journey inward.</p><div class="meditation-circle pulsing" id="meditationCircle" style="width: clamp(150px, 30vw, 250px); height: clamp(150px, 30vw, 250px); background: radial-gradient(circle, rgba(255, 215, 0, 0.4), transparent); border-radius: 50%; margin: 2rem auto; display: flex; justify-content: center; align-items: center; transition: all 1s ease-in-out; animation: pulse-meditation 4s infinite alternate ease-in-out;"><div class="rune-symbol text-7xl text-primary-night" id="meditationRune">ᛗ</div></div><p id="meditationStatus" class="text-gray-400 mt-4 text-center">Ready to begin your inner journey.</p></div>
            </section>
            
            <section id="storytellerPage" class="page">
                <div class="page-content-container"><h2 class="page-title">The Runic Chronicle</h2><p class="page-intro">To add your energy to the veil, you must first align with its frequency. Each week, the veil resonates with a new rune. Contemplate its meaning, then share a story from your life that reflects its theme.</p><div class="whisper-box content-box mb-8" id="storytellerRuneBox"><p class="text-sm uppercase tracking-widest text-yellow-400/70">This Week's Rune</p><div id="storytellerRune" class="text-7xl font-['Spectral',serif] text-primary-night [text-shadow:0_0_15px_rgba(255,215,0,0.8)]"></div><div id="storytellerMeaning" class="text-lg font-['Spectral',serif] italic text-gray-400 mt-2"></div></div><div class="mt-8 flex flex-col items-center"><p id="storytellerStatusMessage" class="text-gray-300 text-center mb-2">Tell your tale, keeper.</p><textarea id="storytellerInput" class="w-full p-4 rounded bg-gray-800 text-white h-40"></textarea><button id="submitStoryButton" class="whisper-button mt-4">Submit Your Story</button></div><div class="storyteller-stories mt-8 pt-6 border-t border-gray-600"><h3 class="text-yellow-400 text-center text-xl font-spectral">Your Personal Chronicle</h3><div id="storiesContainer" class="mt-4"></div></div></div>
            </section>

            <section id="keeperPage" class="page">
                <div class="page-content-container text-gray-300 text-center"><div id="keeper-offering-view"><h2 class="page-title">Become a Keeper</h2><p class="page-intro">The Seeker's Journey leads here. To become a Keeper is to move from observer to guardian. It is a commitment to help preserve this space and support the ongoing expedition into the mystery. Your offering is the final step in your initiation.</p><h3 class="text-2xl font-bold text-yellow-400 mb-4 font-spectral">The Keepers' Circle</h3><p class="mb-4">Each rune below represents a Keeper who has completed their journey. Join them.</p><div id="keepersGrid" class="keepers-grid mb-8"></div><div class="grid grid-cols-1 md:grid-cols-3 gap-6 w-full text-center"><div class="bg-black/30 border border-gray-700 rounded-lg p-6 flex flex-col"><h3 class="text-yellow-400 font-spectral text-2xl">Initiate</h3><p class="font-bold text-white text-4xl my-4">$5</p><p class="text-gray-400 text-sm min-h-[50px]">A one-time offering to show your belief in the mission.</p><ul class="text-left text-gray-300 space-y-2 my-6 flex-grow"><li>✅ Access to the Inner Sanctum lore.</li><li>✅ Your chosen runic initial added to the Keepers' Circle.</li></ul><a href="https://buy.stripe.com/28E6oH6t188VfGf8LN1gs00" target="_blank" rel="noopener noreferrer" class="whisper-button mt-4 p-3">Make an Offering</a></div><div class="bg-black/30 border-2 border-yellow-400 rounded-lg p-6 flex flex-col relative"><p class="absolute -top-3 left-1/2 -translate-x-1/2 bg-yellow-400 text-black font-bold text-xs px-3 py-1 rounded-full">MOST POPULAR</p><h3 class="text-yellow-400 font-spectral text-2xl">Keeper</h3><p class="font-bold text-white text-4xl my-4">$15</p><p class="text-gray-400 text-sm min-h-[50px]">Become a true guardian of the research and its secrets.</p><ul class="text-left text-gray-300 space-y-2 my-6 flex-grow"><li>✅ All benefits of the Initiate tier.</li><li>✅ A personal 3-rune reading, delivered to your email.</li></ul><a href="https://buy.stripe.com/8x24gz4kT74R51B9PR1gs01" target="_blank" rel="noopener noreferrer" class="donate-button mt-4 p-3">Become a Keeper</a></div><div class="bg-black/30 border border-gray-700 rounded-lg p-6 flex flex-col"><h3 class="text-yellow-400 font-spectral text-2xl">Whisperer's Choice</h3><p class="font-bold text-white text-4xl my-4">Custom</p><p class="text-gray-400 text-sm min-h-[50px]">Your offering ensures this portal continues to echo through time for new Seekers.</p><ul class="text-left text-gray-300 space-y-2 my-6 flex-grow"><li>✅ Access to the Inner Sanctum lore.</li><li>✅ Your chosen runic initial added to the Keepers' Circle.</li></ul><a href="https://buy.stripe.com/5kQaEX5oXbl7dy7fab1gs03" target="_blank" rel="noopener noreferrer" class="whisper-button mt-4 p-3">Choose Your Offering</a></div></div></div><div id="sanctum-view" class="hidden"><h2 class="page-title">Welcome, Inner Sanctum</h2><p class="page-intro">Your initiation is complete. Thank you for your offering, Keeper. As a guardian, you are granted access to exclusive tools to aid your journey.</p><div class="text-left border-t border-gray-600 pt-6 mt-6"><h3 class="text-2xl font-bold text-yellow-400 mb-4 font-spectral">The Keeper's Toolkit</h3><p class="mb-4"><strong>Deeper Lore:</strong> The secrets of the runes are now open to you. The Elder Futhark is more than an alphabet; it is a cosmological map. Each rune is a key to a specific type of energy or event in the universe. Fehu (ᚠ), seen as wealth, is truly the untamed, expansive energy of creation...</p><p class="mb-4"><strong>The Keeper's Meditation:</strong> Access the full, extended guided meditation to better align with the valley's energy. [A link to your exclusive audio file would go here]</p><p><strong>The Pyramid Cipher:</strong> Download this high-resolution runic cipher, a key to decoding the hidden whispers of the valley. [A link to your exclusive image file would go here]</p></div></div></div>
            </section>
        </main>

        <footer class="app-footer">
            <div class="social-share-buttons">
                <a href="#" id="share-twitter" class="social-share-button" title="Share on X"><svg viewBox="0 0 24 24" fill="currentColor"><path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"></path></svg></a>
                <a href="#" id="share-facebook" class="social-share-button" title="Share on Facebook"><svg viewBox="0 0 24 24" fill="currentColor"><path d="M14 13.5h2.5l1-4H14v-2c0-1.03 0-2 2-2h1.5V2.14c-.326-.043-1.557-.14-2.857-.14C11.928 2 10 3.657 10 6.7v2.8H7v4h3v9h4z"></path></svg></a>
                <a href="mailto:your-email@example.com" class="social-share-button" title="Commune with the Keepers"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor"><path d="M22 6c0-1.1-.9-2-2-2H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6zm-2 0l-8 5-8-5h16zm0 12H4V8l8 5 8-5v10z"></path></svg></a>
            </div>
            <p class="text-sm text-gray-500 mt-4">&copy; 2025 Ancient Echoes Project. All rights reserved.</p>
        </footer>
    </div>
    
    <div id="lore-modal"><div class="lore-content"><button class="lore-close-button">&times;</button><h3 id="lore-title" class="text-2xl font-bold text-yellow-400 mb-4 font-spectral"></h3><div id="lore-text" class="text-gray-300"></div></div></div>

<script>
document.addEventListener('DOMContentLoaded', () => {
    // --- Element References ---
    const allPages = document.querySelectorAll('.page');
    const pageLinks = document.querySelectorAll('.page-link');
    const mainContentArea = document.getElementById('mainContentArea');
    const initialEntryOverlay = document.getElementById('initialEntryOverlay');
    const menuButton = document.getElementById('menuButton');
    const overlayMenu = document.getElementById('overlayMenu');
    const closeMenuButton = document.getElementById('closeMenuButton');
    const pyramidGroup = document.getElementById('pyramidGroup');
    const runicOutput = document.getElementById('runicOutput');
    const englishOutput = document.getElementById('englishOutput');
    const toggleTranslationButton = document.getElementById('toggleTranslation');
    const keepersGrid = document.getElementById('keepersGrid');
    const sanctumView = document.getElementById('sanctum-view');
    const keeperOfferingView = document.getElementById('keeper-offering-view');
    const mapContainer = document.getElementById('map-container');
    const loreModal = document.getElementById('lore-modal');
    const loreTitle = document.getElementById('lore-title');
    const loreText = document.getElementById('lore-text');
    const loreCloseButton = loreModal.querySelector('.lore-close-button');
    const storytellerRuneEl = document.getElementById('storytellerRune');
    const storytellerMeaningEl = document.getElementById('storytellerMeaning');
    const storiesContainer = document.getElementById('storiesContainer');
    const submitStoryButton = document.getElementById('submitStoryButton');
    const storytellerInput = document.getElementById('storytellerInput');
    const storytellerStatusMessage = document.getElementById('storytellerStatusMessage');
    const drawRunesButton = document.getElementById('drawRunesButton');
    const runeQuestionInput = document.getElementById('runeQuestionInput');
    const runeDisplay = document.getElementById('runeDisplay');
    const runeInterpretation = document.getElementById('runeInterpretation');
    const meditationCircle = document.getElementById('meditationCircle');
    const meditationRune = document.getElementById('meditationRune');
    const meditationStatus = document.getElementById('meditationStatus');
    const canvas = document.getElementById('interactive-background');
    const ctx = canvas.getContext('2d');

    let isGenerating = false;
    let particlesArray = [];
    window.mouse = {x: null, y: null, radius: 100};
    let isBeamActive = false; // Cooldown for beam

    // --- Data Arrays ---
    const ancientWisdoms = [ { runic: "ᛞᚱᛁᛗ ᛞᛖᛈᛖᚱ", english: "Dream deeper." }, { runic: "ᛋᛏᚨᚱᛋ ᚹᚨᛏᚲᚺ", english: "The stars watch." }, { runic: "ᛖᚲᚺᛟ ᛟᚠ ᛏᛁᛗᛖ", english: "Listen to time's echo." }, { runic: "ᚦᛅ ᛋᛏᛟᚾᛋ ᛋᛒᛂᛅᚴ", english: "The stones speak to those who listen." }, { runic: "ᚢᛅᛁᛚ ᛁᛋ ᚦᛁᚾ", english: "Where the worlds touch, the veil is thin." }];
    const mapLore = {
        sun: { title: "Pyramid of the Sun", text: "The largest of the valley's structures. Its orientation to the cosmic north is more precise than that of the Great Pyramid of Giza. Energy scans have detected an unusual electromagnetic beam emanating from its peak.", rune: "ᛋ", runeName: "Sowilo (Sun, Wholeness)" },
        moon: { title: "Pyramid of the Moon", text: "A terraced structure built from sandstone blocks and clay. Below it lies a network of chambers and a small blue lake, untouched for millennia. The water here is said to have unique, life-affirming properties.", rune: "ᛚ", runeName: "Laguz (Water, Intuition)" },
        dragon: { title: "Pyramid of the Dragon", text: "This pyramid is believed to regulate the flow of energy throughout the valley. Its thermal inertia properties are remarkable, maintaining a stable internal temperature regardless of the outside weather.", rune: "ᚢ", runeName: "Uruz (Strength, Power)" },
        tunnels: { title: "Ravne Tunnel Labyrinth", text: "A vast, prehistoric network of tunnels running for kilometers beneath the valley. Within these tunnels, the air has an unusually high concentration of negative ions, creating an atmosphere of healing and tranquility.", rune: "ᛉ", runeName: "Algiz (Protection)" }
    };
    const runeReadings = [ { runes: "ᚠᛉᛟ", interpretation: "Protected wealth and inheritance. Your foundations are strong. Do not fear loss, for your prosperity is watched over by ancestral spirits." }, { runes: "ᚢᚱᚨ", interpretation: "A journey of strength and wisdom is ahead. Primal power fuels your movement, and divine messages will guide your way." }];
    const meditationScripts = { 'ᛗ': "Focus on the self. Feel the connection to all of humanity.", 'ᛟ': "Think of your heritage, your ancestors. Feel their strength.", 'ᛞ': "Embrace the dawn of a new understanding. A breakthrough is near." };
    let currentStorytellerRuneInfo = {};
    
    // --- Core Functions ---
    function showPage(pageId, isNavigatingHistory = false) {
        allPages.forEach(page => page.classList.remove('active'));
        const targetPage = document.getElementById(pageId + 'Page');
        
        if (targetPage) {
            targetPage.classList.add('active');
            window.scrollTo(0, 0);
            if (pageId === 'keeper') {
                const hasDonated = localStorage.getItem('hasDonated') === 'true';
                if(sanctumView) sanctumView.classList.toggle('hidden', !hasDonated);
                if(keeperOfferingView) keeperOfferingView.classList.toggle('hidden', hasDonated);
                generateKeepersGrid(hasDonated ? 30 : 15);
            }
            if (!isNavigatingHistory) {
                history.pushState({page: pageId}, `Ancient Echoes - ${pageId}`, `#${pageId}`);
            }
        } else {
            document.getElementById('homePage').classList.add('active');
            history.replaceState({page: 'home'}, 'Ancient Echoes - Home', window.location.pathname);
        }
    }

    function setupAccordion() {
        const accordionContainer = document.querySelector('.bio-accordion');
        if (!accordionContainer) return;
        accordionContainer.addEventListener('click', e => {
            const header = e.target.closest('.bio-accordion-header');
            if (!header) return;
            const content = header.nextElementSibling;
            const allHeaders = accordionContainer.querySelectorAll('.bio-accordion-header');
            const isActive = header.classList.contains('active');
            allHeaders.forEach(h => { h.classList.remove('active'); h.nextElementSibling.classList.remove('active'); });
            if (!isActive) { header.classList.add('active'); content.classList.add('active'); }
        });
    }

    function generateKeepersGrid(count = 15) {
        if (!keepersGrid) return;
        keepersGrid.innerHTML = '';
        const runes = ['ᚠ','ᚢ','ᚦ','ᚨ','ᚱ','ᚲ','ᚷ','ᚹ','ᚺ','ᚾ','ᛁ','ᛃ','ᛇ','ᛈ','ᛉ','ᛋ','ᛏ','ᛒ','ᛖ','ᛗ','ᛚ','ᛜ','ᛟ','ᛞ'];
        for (let i = 0; i < count; i++) {
            const runeEl = document.createElement('span');
            runeEl.className = 'keeper-rune';
            runeEl.textContent = runes[Math.floor(Math.random() * runes.length)];
            keepersGrid.appendChild(runeEl);
        }
    }
    
    function getAncientCounsel() {
        if (isGenerating) return;
        isGenerating = true;
        runicOutput.style.opacity = '0';
        englishOutput.classList.remove('visible');
        if(toggleTranslationButton) toggleTranslationButton.style.display = 'none';
        whisperBox.classList.add('loading');
        setTimeout(() => {
            const wisdom = ancientWisdoms[Math.floor(Math.random() * ancientWisdoms.length)];
            runicOutput.textContent = wisdom.runic;
            englishOutput.textContent = wisdom.english;
            whisperBox.classList.remove('loading');
            runicOutput.style.opacity = '1'; 
            if(toggleTranslationButton) toggleTranslationButton.style.display = 'inline-block';
            isGenerating = false;
        }, 1500);
    }

    function showLoreModal(point) {
        const data = mapLore[point];
        if (data && loreModal) {
            loreTitle.textContent = data.title;
            loreText.innerHTML = `${data.text}<br><br><p class='mt-4 text-center'>You have discovered the rune of this place: <strong class='text-yellow-400 text-2xl font-spectral'>${data.rune}</strong><br><em>${data.runeName}</em></p>`;
            loreModal.classList.add('visible');
        }
    }

    function setRuneOfTheWeek() {
        const runesOfWeek = [
            { char: 'ᛋ', name: 'Sowilo: Sun, Success' }, { char: 'ᛏ', name: 'Tiwaz: Justice, Sacrifice' },
            { char: 'ᚹ', name: 'Wunjo: Joy, Harmony' }, { char: 'ᚨ', name: 'Ansuz: Wisdom, Communication' },
            { char: 'ᚦ', name: 'Thurisaz: Thorn, Change' }, { char: 'ᚠ', name: 'Fehu: Wealth, Beginnings' },
            { char: 'ᚾ', name: 'Nauthiz: Need, Resistance' },
        ];
        const today = new Date().getDay();
        currentStorytellerRuneInfo = runesOfWeek[today];
        if (storytellerRuneEl) storytellerRuneEl.textContent = currentStorytellerRuneInfo.char;
        if (storytellerMeaningEl) storytellerMeaningEl.textContent = currentStorytellerRuneInfo.name;
    }
    
    function displayStories() {
        if(!storiesContainer) return;
        const stories = JSON.parse(localStorage.getItem('runic_stories') || '[]');
        storiesContainer.innerHTML = '';
        if(stories.length === 0) {
            storiesContainer.innerHTML = `<p class="text-gray-500 text-center italic">Your personal chronicle is empty.</p>`;
            return;
        }
        stories.forEach(story => {
            const storyCard = document.createElement('div');
            storyCard.className = 'story-card';
            storyCard.innerHTML = `<div class="story-rune">${story.rune}</div><p class="story-text">"${story.story}"</p><div class="story-meta"><span>Your Echo</span><span>${story.timestamp}</span></div>`;
            storiesContainer.appendChild(storyCard);
        });
    }

    function fireRunicBeam(targetElement) {
        if (isBeamActive) return; // Cooldown check
        isBeamActive = true;

        const moon = document.getElementById('menuButton');
        if (!moon || !targetElement) { isBeamActive = false; return; }

        const moonRect = moon.getBoundingClientRect();
        const targetRect = targetElement.getBoundingClientRect();
        const moonX = moonRect.left + moonRect.width / 2;
        const moonY = moonRect.top + moonRect.height / 2;
        const targetX = targetRect.left + targetRect.width / 2;
        const targetY = targetRect.top;

        const deltaX = targetX - moonX;
        const deltaY = targetY - moonY;
        const distance = Math.hypot(deltaX, deltaY);
        const angle = Math.atan2(deltaY, deltaX) * (180 / Math.PI);

        const beam = document.createElement('div');
        beam.className = 'shooting-beam';
        
        const runesInner = document.createElement('div');
        runesInner.className = 'shooting-beam-inner';
        const runeChars = 'ᚠᚢᚦᚨᚱᚲᚷᚹᚺᚾᛁᛃᛇᛈᛉᛋᛏᛒᛖᛗᛚᛜᛟᛞ';
        runesInner.textContent = (runeChars.repeat(20)).split('').sort(() => 0.5 - Math.random()).join('');
        beam.appendChild(runesInner);

        beam.style.height = `${distance}px`;
        beam.style.left = `${moonX}px`;
        beam.style.top = `${moonY}px`;
        beam.style.transform = `rotate(${angle + 90}deg)`;
        
        document.body.appendChild(beam);

        requestAnimationFrame(() => {
            beam.style.opacity = '1';
        });

        setTimeout(() => {
            beam.style.opacity = '0';
            setTimeout(() => {
                beam.remove();
                isBeamActive = false; // Reset cooldown
            }, 500);
        }, 1000); // Linger duration
    }

    // --- Particle Animation ---
    function initParticles() { if(!canvas) return; particlesArray = []; let num = (canvas.height * canvas.width) / 9000; for (let i = 0; i < num; i++) { particlesArray.push(new Particle()); } }
    function animateParticles() { if(!ctx || !canvas) return; ctx.clearRect(0,0,canvas.width,canvas.height); for(let p of particlesArray){ p.draw(); p.update(); } requestAnimationFrame(animateParticles); }
    class Particle { constructor(){this.x = Math.random() * canvas.width; this.y = Math.random() * canvas.height; this.size = Math.random() * 2 + 0.5; this.baseX = this.x; this.baseY = this.y; this.density = (Math.random() * 30) + 1;} draw(){ctx.fillStyle = `rgba(255, 215, 0, 0.5)`; ctx.beginPath(); ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2); ctx.closePath(); ctx.fill();} update(){let dx=window.mouse.x-this.x; let dy=window.mouse.y-this.y; let dist=Math.sqrt(dx*dx+dy*dy); if(dist<window.mouse.radius){let fdx=dx/dist; let fdy=dy/dist; let max=window.mouse.radius; let f=(max-dist)/max; let dirX=fdx*f*this.density; let dirY=fdy*f*this.density; this.x -= dirX; this.y -= dirY;}else{if(this.x!==this.baseX){let dx=this.x-this.baseX;this.x-=dx/10;}if(this.y!==this.baseY){let dy=this.y-this.baseY;this.y-=dy/10;}}}}
    
    // --- Event Listeners ---
    initialEntryOverlay.addEventListener('click', () => {
        initialEntryOverlay.classList.add('hidden');
        mainContentArea.classList.add('active');
        if (document.getElementById('menuHint')) document.getElementById('menuHint').style.opacity = '0';
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
        initParticles();
        animateParticles();
    }, { once: true });
    
    window.addEventListener('mousemove', e => { if(window.mouse) { window.mouse.x = e.clientX; window.mouse.y = e.clientY; }});
    window.addEventListener('resize', () => { if(canvas) { canvas.width = window.innerWidth; canvas.height = window.innerHeight; initParticles(); } });
    menuButton.addEventListener('click', () => overlayMenu.classList.add('active'));
    closeMenuButton.addEventListener('click', () => overlayMenu.classList.remove('active'));
    pageLinks.forEach(link => { link.addEventListener('click', (e) => { e.preventDefault(); const pageId = e.currentTarget.dataset.page; showPage(pageId); if(overlayMenu.classList.contains('active')) overlayMenu.classList.remove('active'); }); });
    window.addEventListener('popstate', (e) => { const pageId = (e.state && e.state.page) || window.location.hash.substring(1) || 'home'; showPage(pageId, true); });
    
    if(pyramidGroup) pyramidGroup.addEventListener('click', (e) => { 
        const pyramidElement = e.target.closest('.pyramid');
        if (pyramidElement) {
            getAncientCounsel();
            fireRunicBeam(pyramidElement);
        }
    });

    if(toggleTranslationButton) toggleTranslationButton.addEventListener('click', () => englishOutput.classList.toggle('visible'));
    if(mapContainer) mapContainer.addEventListener('click', e => { if (e.target.classList.contains('hotspot')) showLoreModal(e.target.dataset.point); });
    if(loreCloseButton) loreCloseButton.addEventListener('click', () => loreModal.classList.remove('visible'));
    
    if(submitStoryButton) submitStoryButton.addEventListener('click', () => {
        const storyText = storytellerInput.value.trim();
        if(storyText.length < 10) { if(storytellerStatusMessage) storytellerStatusMessage.textContent = "Your tale is too brief."; return; }
        const stories = JSON.parse(localStorage.getItem('runic_stories') || '[]');
        stories.unshift({ rune: currentStorytellerRuneInfo.char, story: storyText, timestamp: new Date().toLocaleDateString() });
        localStorage.setItem('runic_stories', JSON.stringify(stories));
        displayStories();
        storytellerInput.value = '';
    });
    
    if(drawRunesButton) drawRunesButton.addEventListener('click', () => {
        if(!runeQuestionInput.value) { if(runeInterpretation) runeInterpretation.textContent = "You must first ask a question."; return; }
        const reading = runeReadings[Math.floor(Math.random() * runeReadings.length)];
        if(runeDisplay) runeDisplay.textContent = reading.runes;
        if(runeInterpretation) runeInterpretation.textContent = reading.interpretation;
    });

    if(meditationCircle) setInterval(() => {
        const meditationRunes = Object.keys(meditationScripts);
        const currentRuneChar = meditationRunes[Math.floor(Math.random() * meditationRunes.length)];
        if(meditationRune) meditationRune.textContent = currentRuneChar;
        if(meditationStatus) meditationStatus.textContent = meditationScripts[currentRuneChar];
    }, 8000);

    // --- Initialization ---
    function initialize() {
        setupAccordion();
        setRuneOfTheWeek();
        displayStories();
        generateKeepersGrid(15);
        const urlParams = new URLSearchParams(window.location.search);
        const initialHash = window.location.hash.substring(1);
        let startingPage = 'home';
        if (urlParams.get('from') === 'stripe') {
            localStorage.setItem('hasDonated', 'true');
            startingPage = 'keeper';
            const url = new URL(window.location);
            url.searchParams.delete('from');
            history.replaceState({page: 'keeper'}, `Ancient Echoes - Keeper`, `${url.pathname}#keeper`);
        } else if (initialHash) {
            startingPage = initialHash;
        }
        showPage(startingPage, true);
    }
    
    initialize();
});
</script>

</body>
</html>
